var upnews={};(function(){upnews.init=function(a,b){a.fn.infiniteScroll=function(c){var d=a.extend({autoLoad:false,contentLoad:function(){var e=a.Deferred();e.resolve("<h1>LOADED</h1>");return e.promise();}},c);if(d.autoLoad){a(this).scroll();}a(this).css({position:"relative"});return this.each(function(){this.on=true;var e=this;a(this).scroll(function(){var f=a(this).outerHeight();if(this.on){var g=Math.floor(a(":last",this).position().top);if(g<=f){this.on=false;d.contentLoad().done(function(){e.on=true;});}}});});};upnews.newsService=function(d){var h=null,f=null,e=0,g="";var c=function(k,j){if(h==null||k!=f||j!=e){var i={};if(k){i.activeateNews=k;}i.page=j?j:0;h=a.ajax({url:d,dataType:"json",data:i,type:"POST"}).done(function(l){f=l.activeFeed;e=l.page;g=l.message?l.message:"";});}return h;};this.getFeeds=function(j){var i=a.Deferred();c(j).done(function(k){i.resolve(k.feeds);});return i.promise();};this.getFeed=function(k,j){var i=a.Deferred();c(k,j).done(function(l){i.resolve(l.feed);});return i.promise();};this.getPage=function(){return e;};this.getActiveFeed=function(){return f;};this.getErrorMessage=function(){return g;};};upnews.NewsView={onload:function(){},setup:function(d){var c=this;return this.newsService.getFeeds(d).done(function(e){c.storyContainers={};a(e).each(function(f,h){var g=a.extend({},c.feedDetailView,{$el:a("<div/>")});g.$el.attr("id",c.namespace+"feed"+h.id).addClass("news-stories-container");a("#"+c.namespace+" .view-news").append(g.$el);c.storyContainers["feed"+h.id]=g;});c.feedListView.render(e);}).done(function(){c.getFeed(c.newsService.getActiveFeed(),0).done(function(){if(c.onSuccessfulSetup){c.onSuccessfulSetup();}});});},getFeed:function(e,d){var c=this;if(!c.storyContainers["feed"+e].populated){return c.newsService.getFeed(e,d).done(function(g){if(!g){console.log("No feed object: "+e);g={};g.title="Error";g.id=c.newsService.getActiveFeed();var f=c.storyContainers["feed"+g.id];f.$el.html("<div>"+c.newsService.getErrorMessage()+"</div>");return;}g.id=c.newsService.getActiveFeed();var f=c.storyContainers["feed"+g.id];f.populated=true;f.render(g);}).done(function(){if(c.onSuccessfulRetrieval){c.onSuccessfulRetrieval();}});}}};upnews.NewsFeedDetailView={$el:a("<div/>"),postRender:function(){},page:1,render:function(d){this.$el.html(this.template(d));var c=this;a(".titlebar a",this.$el).click(function(){a(c).trigger("showList");});a(".news-stories",this.$el).infiniteScroll({autoLoad:true,contentLoad:function(){return c.loader(d.id).done(function(e){if(e.success){c.page=e.page+1;}});}});this.postRender();return this;}};upnews.NewsFeedListView={postRender:function(){},render:function(c){this.$el.html(this.template(c));this.postRender();return this;}};};}());