var notificationsPortletView=notificationsPortletView||function(l,x,A,q){var u={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{%(.+?)%\}/g};var z=l(x);var t=z.find(".notification-portlet-wrapper"),d=z,g=z.find(".notification-portlet a"),b=z.find(".notification-error-container"),k=z.find(".notification-loading"),w=z.find(".notification-container"),y=z.find(".notification-detail-wrapper"),m=z.find(".notification-detail-container"),e=z.find(".notification-actions"),j=z.find(".notification-refresh a"),f=z.find(".notification-options"),v=f.find(".today"),p=f.find(".all");var a;var n={days:1};var c={};var i=function(C,B){c[C]=B};var s=function(B){return c[B]||[]};var o=function(D){var B=new Date(D);var F=B.getFullYear();var G=B.getMonth()+1;var C=B.getDate();var E=G+"/"+C+"/"+F;return E};var h=function(C){var D=false;var B=new Date(C);if(B<new Date()){D=true}return D};var r=function(G,D){l.ajax({type:"POST",data:{refresh:D},url:q.invokeNotificationServiceUrl,async:false});l.ajax({url:q.getNotificationsUrl,type:"POST",dataType:"json",data:G,beforeSend:function(){if(y.is(":visible")){y.hide();w.show()}t.hide();k.show();g.unbind("click");f.find("a").unbind("click");w.html(" ");b.html(" ")},success:function(I){var H=I.notificationResponse;B(H);a=d.find(" .notifications a");F.accordion(H);F.viewDetail();F.goBack();F.refresh();F.filterOptions(H);C(H);k.hide();t.fadeIn("fast");f.fadeIn("fast")},error:function(){z.html(" ").text("Request for data failed.")}});var B=function(H){var I='        {% if (_.isUndefined(data.categories) || _.isEmpty(data.categories)) { %}           <div class="no-notifications-container">             <h3>You have 0 notifications.</h3>           </div>         {% } else { %}           {% var accordion = data.categories.length > 1; %}           {% _.each(data.categories, function(category) { %}             <div class="notification-trigger">               <h3 class="portlet-section-header trigger-symbol" role="header">                 {{ category.title }}                 {% if (accordion) { %}                   ({{ (category.entries) ? category.entries.length : 0 }})                 {% } %}               </h3>             </div>             {% if (!category.entries || category.entries.length < 1) { %}               <!-- no notifications -->             {% } else { %}               <div class="notification-content" style="display: none;">                 <ul class="notifications">                   {% _.each(category.entries, function(entry) {                       var states = "";                       for (var prop in entry.states) {                           if (entry.states.hasOwnProperty(prop)) {                               if (states.length != 0) states += " ";                               states += prop.toLowerCase();                           }                       } %}                     <li class="{{ states }}">                       <a href="{{ entry.url || "javascript://" }}"                          data-linkText="{{ escape(entry.linkText) }}"                          data-id="{{ entry.id }}"                          data-body="{{ escape(entry.body) }}"                          data-title="{{ entry.title }}"                          data-source="{{ entry.source }}"                          {% if (entry.dueDate) { %}                          data-duedate="{{ entry.dueDate.time }}"                          {% } %}                          >                          <i class="fa fa-exclamation-triangle"></i> {{ entry.title }}                        </a>                       {% if ( entry.dueDate ) {                         data.registerAction(entry.id, entry.availableActions);                       %}                       {% if (data.isPastDue(entry.dueDate.time)) { %}                         <p><span class="label label-danger">                           Due {{ data.getDateFormat(entry.dueDate.time) }}                           &nbsp;<i class="fa fa-exclamation-circle"></i></span></p>                       {% } else { %}                         <p><span class="label label-default">                           Due {{ data.getDateFormat(entry.dueDate.time) }}</span></p>                         {% } %}                       {% } %}                       <span class="completed-badge">&#10004;</span>                     </li>                   {% }); %}                 </ul>               </div>             {% } %}           {% }); %}         {% } %}       ';var J=A.extend({},H,{registerAction:i,isPastDue:h,getDateFormat:o});var K=A.template(I,J,{variable:"data",interpolate:u.interpolate,evaluate:u.evaluate});w.html(" ").prepend(K)};var F={accordion:function(H){if(!H.categories||H.categories.length===1){t.removeClass("accordion");w.children().show()}else{notificationsAccordion(l,w);t.addClass("accordion")}},viewDetail:function(){a.click(function(){var H={body:l(this).data("body"),title:l(this).data("title"),source:l(this).data("source"),link:l(this).attr("href"),lnkTxt:l(this).data("linkText"),ddate:l(this).data("duedate"),id:l(this).data("id")};var M='          <h3>{{ title }}</h3>           <div>{{ unescape(body) }}</div>         {% if (ddate) { %}           {% if (isPastDue(ddate)) { %}             <p><span class="label label-danger">               Due {{ getDateFormat(ddate) }}               &nbsp;<i class="fa fa-exclamation-circle"></i></span></p>           {% } else { %}             <p><span class="label label-default">               Due {{ getDateFormat(ddate) }}</span></p>           {% } %}         {% } %}           <p class="notification-source">             Source: {{ source }}           </p>           <div class="buttons">           {% if (link) {%}             {% if (lnkTxt) {%}             <a class="btn btn-success" href="{{link}}">{{lnkTxt}}</a>             {%} else if (source) {%}             <a class="btn btn-success" href="{{link}}">View Notice in {{source}}</a>             {%} else {%}             <a class="btn btn-success" href="{{link}}">Follow Notice Link</a>             {% } %}           {% } %}             <a class="btn btn-primary notification-back-button">Back to Notifications</a>           </div>           ';var L=A.extend({},H,{isPastDue:h,getDateFormat:o});var N=A.template(M,L,{interpolate:u.interpolate,evaluate:u.evaluate});var O=["{% _.each(actions, function(action) { %}",'<a href="{{ getActionUrl(notificationId, action) }}" class="button">{{ action.label }}</a>',"{% }); %}"].join("");var K=s(H.id);var P=function(S,R){var Q=q.invokeActionUrlTemplate.replace("NOTIFICATIONID",S).replace("ACTIONID",R.id);return Q};var I={notificationId:H.id,actions:K,getActionUrl:P};var J=A.template(O,I,u);l.each([w,b],function(){l(this).hide("slide",200,function(){m.html(" ").append(N);F.goBack();e.html("").html(J);y.show()})});return false})},goBack:function(){backButton=z.find(".notification-back-button");backButton.click(function(){y.hide("slide",{direction:"right"},200,function(){w.show();b.show()});return false}).hover(function(){l(this).addClass("hover")},function(){l(this).removeClass("hover")})},refresh:function(){j.click(function(){r(n,"true");return false})},filterOptions:function(H){v.click(function(){E(l(this),{days:1});return false});p.click(function(){E(l(this));return false})}};var E=function(H,I){n=I||{};if(H.hasClass("active")){return false}else{r(n);f.find("a").removeClass("active");H.addClass("active")}return n};var C=function(J){if(J.errors){var H='          {% _.each(errors, function(error) { %}             <div class="alert alert-danger alert-dismissible" role="alert" errorkey="{{ error.key }}">               {{ error.source }}: {{ error.error }}               <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>             </div>           {% }); %}         ';var I=A.template(H,J,{interpolate:u.interpolate,evaluate:u.evaluate});b.show().append(I);b.find(".remove").click(function(){var K=l(this).parent();K.fadeOut("fast",function(){var L=[];l.ajax({url:(q.hideErrorUrl).replace("ERRORKEY",K.attr("errorkey")),type:"POST",success:function(){return false}})});return false})}}};r(n)};