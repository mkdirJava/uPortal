var upcal=upcal||{};if(!upcal.init){upcal.init=function(c,b,d){var a=new Array();upcal.CalendarDay=d.Model.extend({defaults:function(){return{code:null,displayName:null,events:new upcal.CalendarEventList()};}});upcal.CalendarEvent=d.Model.extend({defaults:function(){return{summary:null,description:null,location:null,startTime:null,endTime:null,dateStartTime:null,dateEndTime:null,startDate:null,endDate:null,allDay:false,multiDay:false,colorIndex:0};}});upcal.CalendarError=d.Model.extend({defaults:function(){return{};}});upcal.CalendarDayList=d.Collection.extend({model:upcal.CalendarDay});upcal.CalendarEventList=d.Collection.extend({model:upcal.CalendarEvent});upcal.CalendarErrorList=d.Collection.extend({model:upcal.CalendarError});upcal.EventListView=d.View.extend({el:".upcal-event-view",postRender:function(){},render:function(){this.$(".upcal-event-list").html(this.template({days:this.model.toJSON()}));var e=this;e.$(".upcal-event-list a").click(function(){var k,f;k=c(this);var j=c(k.parents("div.day").get(0));var h=e.$(".day").index(j);var l=c(k.parents("div.upcal-event").get(0));var g=c(j).find(".upcal-event").index(l);var i=e.model.at(h).get("events").at(g);e.trigger("eventSelected",i);});this.postRender();return this;}});upcal.EventDetailView=d.View.extend({el:".upcal-event-details",postRender:function(){},render:function(){this.$(".upcal-event-detail").html(this.template({event:this.model.toJSON()}));var e=this;this.$(".titlebar a").click(function(){e.trigger("showList");});this.postRender();return this;}});upcal.CalendarParameterView=d.View.extend({render:function(){this.$el.append(this.template(this.model));}});upcal.CalendarView=d.Model.extend({defaults:function(){return{container:null,detailView:new upcal.EventDetailView(),listView:new upcal.EventListView(),eventsUrl:null,startDate:null,days:7};},initialize:function(){var e=this;var f=window.navigator.userLanguage||window.navigator.language;if(c.datepicker.regional[f]!=undefined){c.datepicker.setDefaults(c.datepicker.regional[f]);}else{if(c.datepicker.regional[f.substring(0,2)]!=undefined){c.datepicker.setDefaults(c.datepicker.regional[f.substring(0,2).toLowerCase()]);}else{c.datepicker.setDefaults(c.datepicker.regional[""]);}}c(e.get("container")).find(".upcal-inline-calendar").datepicker({inline:true,dateFormat:"mm/dd/yy",changeMonth:false,changeYear:false,defaultDate:this.get("startDate"),onSelect:function(g){e.set("startDate",g);e.getEvents(e.get("startDate"),e.get("days"));}});this.get("listView").bind("eventSelected",function(g){e.get("listView").$el.hide();e.get("detailView").$el.show();e.get("detailView").model=g;e.get("detailView").render();});this.get("detailView").$(".upcal-view-return").click(function(){e.get("listView").$el.show();e.get("detailView").$el.hide();});return this;},getEvents:function(e,l){var g,f;g=this;f=g.get("listView");f.$(".upcal-loading-message").show();f.$(".upcal-event-list").hide();var k=f.$(".upcal-event-errors");k.hide();k.empty();var j=g.get("startDate").replace(/\//g,"");var i=g.get("days");var h=g.get("eventsUrl").replace(/START/,j).replace(/DAYS/,i);c.ajax({url:h,success:function(p){var q=new upcal.CalendarDayList();var n,m,o;if(p&&p.errors&&p.errors.length>0){c(p.errors).each(function(r,s){var t=c("<p></p>");t.text(s);k.append(t);});k.show();}if(p&&p.dateMap&&p.dateNames){m=p.dateMap;o=p.dateNames;}if(m&&o){c.each(m,function(r,s){n=new upcal.CalendarDay({code:r,displayName:o[r]});c(s).each(function(t,u){var v=u.event;v.colorIndex=u.colorIndex;n.get("events").add(new upcal.CalendarEvent(v));});q.add(n);});}f.model=q;f.render();f.$(".upcal-loading-message").hide();f.$(".upcal-event-list").show();}});}});};}