var weatherPortlet=weatherPortlet||{};(function(k,l){l.defaults("weatherPortlet.editCities",{saveOrderUrl:null,updateUnitUrl:null,deleteLocationUrl:null,noLocationsMessage:"No Locations Found",searchingMessage:"Searching ...",evenRow:"r1",oddRow:"r2",templateRowClass:"template",cityRowClass:"movable",selectors:{locationRow:".locations table tr.movable",templateRow:".locations table tr.template",orderCell:"td.handle",locationCode:"input[name=code]",selectUnits:".locations table tr.movable select.select-units",deleteLocation:".locations table tr.movable .delete-location-link",addLocationLink:".add-location-link",locationSearch:".location-search",locationList:".locations",locationSearchForm:".locate-search-form",locationSearchMessage:".search-message",locationSearchError:"#location-search-error",locationSearchErrorMessage:"#location-search-error .error-text",cancelSearchLink:".weather-search-form-cancel",searchResults:".search-results",searchResultsForm:".search-results .select-location-form",searchResultsOptions:'.search-results .select-location-form select[name="locationCode"]',searchResultsSelectedOption:'select[name="locationCode"] option:selected'},events:{addCity:null,deleteCity:null}});var i=function(a){a.refreshLocationRows();a.locate("selectUnits").change(function(b){j(a,b,k(this));});a.locate("deleteLocation").click(function(b){g(a,b,k(this));});a.locate("addLocationLink").click(function(){a.locate("locationList").hide();a.locate("locationSearch").show();});a.locate("locationSearchForm").ajaxForm({dataType:"json",beforeSubmit:function(){a.locate("locationSearchMessage").show();},success:function(b){var d=b.locations;if(d.length==0){a.locate("locationSearchMessage").text(a.options.noLocationsMessage);}else{var e=a.locate("searchResultsOptions").html("").get(0);k.each(d,function(f,n){e.options[f]=new Option(n.city+", "+n.stateOrCountry,n.locationCode);});a.locate("locationSearch").hide();a.locate("searchResults").show();}var c=b.error;if(c&&c.length>0){a.locate("locationSearchErrorMessage").text(c);a.locate("locationSearchError").show();}}});a.locate("cancelSearchLink").click(function(){return h(a);});a.locate("searchResultsForm").ajaxForm({dataType:"json",beforeSubmit:function(b,c,d){var e=a.locate("searchResultsSelectedOption",c).text();b[b.length]={name:"location",value:e};},success:function(b){if(b.status!="success"){return;}h(a);var e=a.locate("templateRow");var d=e.clone();var c=e.siblings(":last");if(c.size()==0){c=e;}c.after(d);d.removeClass(a.options.templateRowClass);d.addClass(a.options.cityRowClass);a.locate("locationCode",d).val(b.location.code);var f=d.find("select.select-units");f.attr("name",f.attr("name")+b.location.code);f.attr("id",f.attr("id")+b.location.code);f.find('option[value="'+b.location.temperatureUnit+'"]').attr("selected","selected");d.find(".location-name").text(b.location.name);d.show();a.events.addCity.fire();}});};weatherPortlet.editCities=function(c,b){var a=l.initView("weatherPortlet.editCities",c,b);a.refreshLocationRows=function(){a.locate("locationRow").each(function(e,d){a.locate("orderCell",d).html((e+1)+".");if(e%2==0){k(d).removeClass(a.options.oddRow).addClass(a.options.evenRow);}else{k(d).removeClass(a.options.evenRow).addClass(a.options.oddRow);}});};a.saveOrder=function(f,e,d){var n=new Array();k.each(d,function(p,m){n[p]=a.locate("locationCode",m).val();});k.post(a.options.saveOrderUrl,{locationCodes:n},function(m){},"json");};i(a);return a;};var j=function(d,e,b){var a=b.parents(".locations table tr.movable");var c=d.locate("locationCode",a).val();var f=b.val();k.post(d.options.updateUnitUrl,{locationCode:c,unit:f},function(n){},"json");};var g=function(d,e,b){var a=b.parents(".locations table tr.movable");var c=d.locate("locationCode",a).val();k.post(d.options.deleteLocationUrl,{locationCode:c},function(f){if(f.status=="success"){a.remove();d.events.deleteCity.fire();}else{}},"json");};var h=function(a){a.locate("locationSearch").hide();a.locate("searchResults").hide();a.locate("locationList").show();a.locate("locationSearchForm").clearForm();a.locate("locationSearchMessage").text(a.options.searchingMessage);a.locate("locationSearchMessage").hide();return false;};})(jQuery,fluid);if(!weatherPortlet.jQuery){weatherPortlet.jQuery=jQuery.noConflict(true);weatherPortlet.fluid=fluid;}else{jQuery.noConflict(true);}fluid=null;fluid_1_5=null;