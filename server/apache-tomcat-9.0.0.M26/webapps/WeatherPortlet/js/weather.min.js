var weatherPortlet=weatherPortlet||{};(function(d,c){c.defaults("weatherPortlet.editCities",{saveOrderUrl:null,updateUnitUrl:null,deleteLocationUrl:null,noLocationsMessage:"No Locations Found",searchingMessage:"Searching ...",evenRow:"r1",oddRow:"r2",templateRowClass:"template",cityRowClass:"movable",selectors:{locationRow:".locations table tr.movable",templateRow:".locations table tr.template",orderCell:"td.handle",locationCode:"input[name=code]",selectUnits:".locations table tr.movable select.select-units",deleteLocation:".locations table tr.movable .delete-location-link",addLocationLink:".add-location-link",locationSearch:".location-search",locationList:".locations",locationSearchForm:".locate-search-form",locationSearchMessage:".search-message",locationSearchError:"#location-search-error",locationSearchErrorMessage:"#location-search-error .error-text",cancelSearchLink:".weather-search-form-cancel",searchResults:".search-results",searchResultsForm:".search-results .select-location-form",searchResultsOptions:'.search-results .select-location-form select[name="locationCode"]',searchResultsSelectedOption:'select[name="locationCode"] option:selected'},events:{addCity:null,deleteCity:null}});var f=function(g){g.refreshLocationRows();g.locate("selectUnits").change(function(h){e(g,h,d(this))});g.locate("deleteLocation").click(function(h){b(g,h,d(this))});g.locate("addLocationLink").click(function(){g.locate("locationList").hide();g.locate("locationSearch").show()});g.locate("locationSearchForm").ajaxForm({dataType:"json",beforeSubmit:function(){g.locate("locationSearchMessage").show()},success:function(k){var i=k.locations;if(i.length==0){g.locate("locationSearchMessage").text(g.options.noLocationsMessage)}else{var h=g.locate("searchResultsOptions").html("").get(0);d.each(i,function(m,l){h.options[m]=new Option(l.city+", "+l.stateOrCountry,l.locationCode)});g.locate("locationSearch").hide();g.locate("searchResults").show()}var j=k.error;if(j&&j.length>0){g.locate("locationSearchErrorMessage").text(j);g.locate("locationSearchError").show()}}});g.locate("cancelSearchLink").click(function(){return a(g)});g.locate("searchResultsForm").ajaxForm({dataType:"json",beforeSubmit:function(k,j,i){var h=g.locate("searchResultsSelectedOption",j).text();k[k.length]={name:"location",value:h}},success:function(l){if(l.status!="success"){return}a(g);var i=g.locate("templateRow");var j=i.clone();var k=i.siblings(":last");if(k.size()==0){k=i}k.after(j);j.removeClass(g.options.templateRowClass);j.addClass(g.options.cityRowClass);g.locate("locationCode",j).val(l.location.code);var h=j.find("select.select-units");h.attr("name",h.attr("name")+l.location.code);h.attr("id",h.attr("id")+l.location.code);h.find('option[value="'+l.location.temperatureUnit+'"]').attr("selected","selected");j.find(".location-name").text(l.location.name);j.show();g.events.addCity.fire()}})};weatherPortlet.editCities=function(g,h){var i=c.initView("weatherPortlet.editCities",g,h);i.refreshLocationRows=function(){i.locate("locationRow").each(function(j,k){i.locate("orderCell",k).html((j+1)+".");if(j%2==0){d(k).removeClass(i.options.oddRow).addClass(i.options.evenRow)}else{d(k).removeClass(i.options.evenRow).addClass(i.options.oddRow)}})};i.saveOrder=function(k,l,m){var j=new Array();d.each(m,function(n,o){j[n]=i.locate("locationCode",o).val()});d.post(i.options.saveOrderUrl,{locationCodes:j},function(n){},"json")};f(i);return i};var e=function(i,h,k){var l=k.parents(".locations table tr.movable");var j=i.locate("locationCode",l).val();var g=k.val();d.post(i.options.updateUnitUrl,{locationCode:j,unit:g},function(m){},"json")};var b=function(h,g,j){var k=j.parents(".locations table tr.movable");var i=h.locate("locationCode",k).val();d.post(h.options.deleteLocationUrl,{locationCode:i},function(l){if(l.status=="success"){k.remove();h.events.deleteCity.fire()}else{}},"json")};var a=function(g){g.locate("locationSearch").hide();g.locate("searchResults").hide();g.locate("locationList").show();g.locate("locationSearchForm").clearForm();g.locate("locationSearchMessage").text(g.options.searchingMessage);g.locate("locationSearchMessage").hide();return false}})(jQuery,fluid);if(!weatherPortlet.jQuery){weatherPortlet.jQuery=jQuery.noConflict(true);weatherPortlet.fluid=fluid}else{jQuery.noConflict(true)}fluid=null;fluid_1_5=null;